<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quantum Dots 3D Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="app.css">
  <script src="https://cdn.jsdelivr.net/npm/3dmol@2.1.0/build/3Dmol-min.js"></script>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
<header class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <h1 class="text-2xl font-semibold">Quantum Dots 3D Viewer</h1>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-10">

  <!-- Filters -->
  <section class="card p-4 sm:p-6 mb-6">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg font-semibold">Filters</h2>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="flex flex-col">
        <label class="label-underline text-sm font-medium mb-1">System Type</label>
        <select id="filter-system" class="input"><option value="">— Select —</option></select>
      </div>
      <div class="flex flex-col">
        <label class="label-underline text-sm font-medium mb-1">Material</label>
        <select id="filter-material" class="input" disabled><option value="">— Select —</option></select>
      </div>
      <div class="flex flex-col">
        <label class="label-underline text-sm font-medium mb-1">Size (nm)</label>
        <select id="filter-size" class="input" disabled><option value="">— Select —</option></select>
      </div>
      <div class="flex flex-col">
        <label class="label-underline text-sm font-medium mb-1">DFT Functional</label>
        <select id="filter-functional" class="input" disabled><option value="">— Select —</option></select>
      </div>
      <div class="flex flex-col">
        <label class="label-underline text-sm font-medium mb-1">Run Type</label>
        <select id="filter-runtype" class="input" disabled><option value="">— Select —</option></select>
      </div>
      <div class="flex flex-col sm:col-span-2 lg:col-span-2">
        <label class="label-underline text-sm font-medium mb-1">Structure File</label>
        <select id="xyz-file" class="input" disabled><option value="">— Select —</option></select>
      </div>
    </div>

    <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
      <button id="download-btn" disabled class="px-6 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white font-semibold shadow">Download Structure</button>
      <button id="download-png-btn" disabled class="px-6 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-semibold shadow">Download PNG</button>
      <button id="reset-btn" class="px-6 py-2 rounded-lg bg-red-500 hover:bg-red-600 text-white font-semibold shadow">Reset</button>
    </div>
  </section>

  <!-- Toggle miniCAT -->
  <div class="flex justify-center my-4">
    <button id="toggle-cat-card" class="px-6 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 text-white font-semibold shadow">
      Attach Ligand using miniCAT
    </button>
  </div>

  <!-- miniCAT card -->
  <section id="cat-card" class="card p-4 sm:p-6 mb-6 hidden">
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-semibold">Attach Ligand (miniCAT)</h3>
      <span class="text-xs text-slate-500">Needs a loaded QD</span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- Left: form -->
      <div class="lg:col-span-2 space-y-4">
        <!-- Anionic job only -->
        <div class="rounded-lg border p-3 bg-orange-50">
          <div class="font-semibold mb-2">Anionic ligands</div>

          <div id="an_rows" class="space-y-2"></div>
          <button id="an_add" class="px-3 py-1 rounded bg-orange-200 hover:bg-orange-300 text-slate-800">+ Add</button>

          <!-- fixed dummy = Cl (hidden) -->
          <input id="an_dummy" type="hidden" value="Cl">

          <div class="mt-3">
            <div class="text-sm">Ligand distribution</div>
            <div class="mt-1 flex gap-6">
              <label class="inline-flex items-center gap-1 text-sm"><input type="radio" name="an_mode" value="random" checked> random</label>
              <label class="inline-flex items-center gap-1 text-sm"><input type="radio" name="an_mode" value="segmented"> segmented</label>
            </div>
          </div>
        </div>

        <!-- Run + outputs -->
        <div class="flex flex-wrap items-center gap-3">
          <button id="run-cat-btn" class="px-5 py-2 rounded-lg bg-slate-900 text-white shadow" disabled>Run CAT</button>
	  <button id="reset-cat-btn" class="px-5 py-2 rounded-lg bg-red-500 hover:bg-red-600 text-white shadow">Reset</button>
          <span id="cat-status" class="text-sm text-slate-600">Add ligands and select a QD.</span>
        </div>

        <div class="mt-3 flex items-center gap-3">
          <label for="cat-output-select" class="text-sm font-medium">Choose CAT output:</label>
          <select id="cat-output-select" class="input min-w-[220px]" disabled>
            <option value="">— none —</option>
          </select>
          <button id="download-catxyz-btn"
            class="px-5 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white shadow"
            disabled>
            Download CAT-XYZ
          </button>
        </div>
      </div>

      <!-- Right: terminal -->
      <div class="lg:col-span-1">
        <div class="text-sm font-semibold mb-1">miniCAT log</div>
        <pre id="cat-term" class="h-64 overflow-auto bg-slate-900 text-slate-100 p-3 rounded-lg text-xs"></pre>
      </div>
    </div>
  </section>

  <!-- Main grid -->
  <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 card">
      <div class="card-head">
        <h3 class="font-semibold">3D View</h3>
        <span class="hint">Drag to rotate • Scroll to zoom</span>
      </div>
      <div id="viewer" class="relative w-full h-[560px]"></div>
      <div id="traj-controls" class="px-4 sm:px-6 py-3 hidden"></div>
    </div>

    <div class="card">
      <div class="card-head">
        <h3 class="font-semibold">Structure Details</h3>
        <span class="hint">Hover badges</span>
      </div>
      <div class="p-4 sm:p-6 space-y-6">
        <div id="details-content" class="text-[15px] leading-6 text-slate-800"></div>

        <div>
          <div class="text-sm font-semibold mb-2">Ratios</div>
          <div id="ratios-wrap" class="flex flex-wrap"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="subcard">
            <h4 class="subcard-title">Stoichiometry</h4>
            <div id="charge-warning" class="mb-2"></div>
            <div id="stoich-totals" class="mb-2 text-lg font-semibold"></div>
            <div id="stoich-core" class="mb-3"></div>
            <div id="stoich-shell" class="mb-3"></div>
            <div id="stoich-lig" class="mb-1"></div>
          </div>
          <div class="subcard">
            <h4 class="subcard-title">Viewer Parameters</h4>
            <div class="flex flex-col space-y-2 text-sm">
              <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="style-radio" value="ballstick"><span>Ball &amp; Stick</span></label>
              <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="style-radio" value="sphere" checked><span>Space Filling</span></label>
              <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="style-radio" value="stick"><span>Sticks</span></label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<!-- Toggle button fixed at the bottom of the page area -->
<div class="flex justify-center my-6">
  <button id="toggle-props-btn"
          class="px-6 py-2 rounded-lg bg-indigo-600 text-white font-semibold shadow opacity-60 cursor-not-allowed"
          disabled>
    Plot Proprieties
  </button>
</div>

<!-- Proprieties card (hidden until the button is clicked) -->
<section id="props-card" class="card mb-12 hidden">
  <div class="card-head">
    <h3 class="font-semibold">Proprieties</h3>
  </div>

  <div id="props-toolbar" class="px-6 pb-2 text-sm text-slate-600">
    Folder: <span id="props-folder-label" class="font-mono"></span>
  </div>

  <div id="props-body" class="p-6">
    <div id="props-loading" class="text-sm text-slate-600">Preparing command…</div>
    <!-- We will inject an iframe here with the returned HTML -->
  </div>
</section>
</main>

<div id="tooltip" class="tooltip rounded-lg bg-slate-900 text-white text-xs px-2 py-1 shadow-lg"></div>

<script src="file_list.js"></script>
<script src="app.js"></script>
</body>
</html>

